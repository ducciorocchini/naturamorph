Here is a **clean, self-contained Markdown document** describing the geometric Barnsley fern Python function.
You can paste this directly into a `.md` file, GitHub README, or documentation site.

---

# Geometric Fern (Barnsley IFS) in Python

This document describes a reusable Python function that generates and optionally plots a **geometric Barnsley fern** using an **Iterated Function System (IFS)**.

The Barnsley fern is a classic example of a **fractal generated by affine transformations**, producing a plant-like structure from simple linear rules.

---

## Mathematical idea

At each iteration, a point ((x, y)) is transformed by **one of four affine maps**, chosen probabilistically:

| Probability | Transformation | Interpretation       |
| ----------- | -------------- | -------------------- |
| 1%          | Stem           | Vertical contraction |
| 85%         | Main leaflet   | Self-similar growth  |
| 7%          | Left leaflet   | Smaller side leaflet |
| 7%          | Right leaflet  | Smaller side leaflet |

Over many iterations, the points converge to a fern-shaped attractor.

---

## Python implementation

### Function definition

```python
import numpy as np
import matplotlib.pyplot as plt


def barnsley_fern(
    n=200_000,
    seed=0,
    point_size=0.2,
    color="black",
    show=True,
    save=None,
    figsize=(6, 10)
):
    """
    Generate and optionally plot a geometric Barnsley fern.

    Parameters
    ----------
    n : int
        Number of points.
    seed : int
        Random seed for reproducibility.
    point_size : float
        Size of points in the plot.
    color : str
        Point color.
    show : bool
        Whether to display the plot.
    save : str or None
        Filename to save the figure (e.g. 'fern.png'), or None.
    figsize : tuple
        Figure size.

    Returns
    -------
    xs, ys : numpy arrays
        Coordinates of the fern points.
    """

    rng = np.random.default_rng(seed)

    x, y = 0.0, 0.0
    xs = np.empty(n)
    ys = np.empty(n)

    for i in range(n):
        r = rng.random()

        if r < 0.01:
            # stem
            x, y = 0.0, 0.16 * y
        elif r < 0.86:
            # main leaflet
            x, y = 0.85 * x + 0.04 * y, -0.04 * x + 0.85 * y + 1.6
        elif r < 0.93:
            # left leaflet
            x, y = 0.20 * x - 0.26 * y, 0.23 * x + 0.22 * y + 1.6
        else:
            # right leaflet
            x, y = -0.15 * x + 0.28 * y, 0.26 * x + 0.24 * y + 0.44

        xs[i] = x
        ys[i] = y

    if show or save:
        fig, ax = plt.subplots(figsize=figsize)
        ax.scatter(xs, ys, s=point_size, c=color, marker=".", linewidths=0)
        ax.set_aspect("equal")
        ax.axis("off")
        plt.tight_layout()

        if save is not None:
            plt.savefig(save, dpi=300, bbox_inches="tight", pad_inches=0)

        if show:
            plt.show()
        else:
            plt.close(fig)

    return xs, ys
```

---

## Usage examples

### Generate points only

```python
x, y = barnsley_fern(show=False)
```

### Plot the fern

```python
barnsley_fern(n=180_000, seed=42)
```

### Save a high-resolution image

```python
barnsley_fern(
    n=300_000,
    point_size=0.15,
    save="geometric_fern.png",
    show=False
)
```

---

## Making the fern more “geometric”

* **Chunkier appearance**

  ```python
  barnsley_fern(point_size=0.5)
  ```

* **Less noise / clearer structure**

  ```python
  barnsley_fern(n=80_000)
  ```

* **Square-pixel look**
  Replace the marker:

  ```python
  ax.scatter(xs, ys, s=0.3, marker="s")
  ```

---

## Notes

* The function is **pure**: it returns data regardless of plotting.
* Plotting and saving are **optional side effects**.
* Fully compatible with:

  * scripts
  * Jupyter notebooks
  * RStudio via **reticulate**
* Suitable for extension to:

  * animation
  * deterministic IFS
  * parameterized fern variants
  * package/module form

---

## Ongoing:

* write a **mathematical derivation section**
* convert this into a **Python package**
* create **multiple fern species**
* add **animation or interactivity**

Just tell me.
